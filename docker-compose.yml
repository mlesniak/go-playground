version: "3.3"
services:
    main:
        labels:
        - log
        image: mlesniak/go-demo:latest
        ports:
            - 8080:8080
        volumes:
            - type: volume
              source: logs
              target: /app/logs

    filebeat:
        # We should build our own docker container here with filebeat.yml.
        # build:
            # context: .
            # dockerfile: Dockerfile-filebeat
        image: docker.elastic.co/beats/filebeat-oss:7.6.2
        user: root
        volumes:
            - type: bind
              source: ./deployments/filebeat/filebeat.yml
              target: /usr/share/filebeat/filebeat.yml

            # Access stdout containers
            - /var/lib/docker/containers/:/var/lib/docker/containers/:ro
            - /var/run/docker.sock:/var/run/docker.sock

            # Persist filebeat data to prevent data duplication
            - filebeat-data:/usr/share/filebeat/data/

volumes:
    logs:
    filebeat-data:


# -----------------------------------------------------------------------------------------------------
# -v $(pwd)/deployments/filebeat/filebeat.yml:/usr/share/filebeat/filebeat.yml \
# -v $(pwd)/logs:/logs \